<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بازی دوز </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f3f4f6; /* Tailwind gray-100 */
            margin: 0;
            padding: 1rem;
        }
        .credits {
            font-size: 0.9rem;
            color: #4b5563; /* Tailwind gray-600 */
            text-align: center;
            margin-bottom: 1.5rem; /* Increased margin */
            padding: 0.5rem;
            background-color: #e5e7eb; /* Tailwind gray-200 */
            border-radius: 6px;
            max-width: 90%;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 300px;
            height: 300px;
            margin-bottom: 20px;
            background-color: #d1d5db; /* Tailwind gray-300 */
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .cell {
            background-color: #ffffff; /* White */
            border: 2px solid #9ca3af; /* Tailwind gray-400 */
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            color: #374151; /* Tailwind gray-700 */
        }
        .cell:hover:not(.occupied) { /* فقط خانه‌های خالی هنگام هاور تغییر رنگ دهند */
            background-color: #e5e7eb; /* Tailwind gray-200 */
        }
        .cell.x {
            color: #ef4444; /* Tailwind red-500 */
        }
        .cell.o {
            color: #3b82f6; /* Tailwind blue-500 */
        }
        .cell.occupied { /* کلاسی برای جلوگیری از هاور روی خانه‌های پر شده */
            cursor: not-allowed;
        }
        .status {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #1f2937; /* Tailwind gray-800 */
            text-align: center;
            min-height: 2.25rem; /* برای جلوگیری از پرش صفحه هنگام تغییر متن */
        }
        button {
            background-color: #10b981; /* Tailwind emerald-500 */
            color: white;
            padding: 12px 24px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        button:hover {
            background-color: #059669; /* Tailwind emerald-600 */
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            border: 1px solid #e5e7eb; /* Tailwind gray-200 */
            width: 90%;
            max-width: 400px;
        }
        .message-box h2 {
            font-size: 1.75rem;
            margin-bottom: 15px;
            color: #111827; /* Tailwind gray-900 */
        }
        .message-box button {
            margin-top: 20px;
            background-color: #3b82f6; /* Tailwind blue-500 */
        }
        .message-box button:hover {
             background-color: #2563eb; /* Tailwind blue-600 */
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 999;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="credits">
        طراحی شده توسط SxCd و برای ارتباط با ایدی تلگرامی @jams047 در ارتباط باشید
    </div>
    <h1 class="text-4xl font-bold text-gray-700 mb-8">بازی دوز با هوش مصنوعی</h1>

    <div id="status" class="status">نوبت شما (X)</div>
    <div id="board" class="board">
        </div>
    <button id="restartButton">شروع مجدد</button>

    <div id="messageBox" class="message-box hidden">
        <h2 id="messageText"></h2>
        <button id="closeMessageButton">باشه</button>
    </div>
    <div id="overlay" class="overlay hidden"></div>

    <script>
        const boardElement = document.getElementById('board');
        const statusElement = document.getElementById('status');
        const restartButton = document.getElementById('restartButton');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const closeMessageButton = document.getElementById('closeMessageButton');
        const overlay = document.getElementById('overlay');

        const PLAYER_X = 'X';
        const PLAYER_O = 'O'; // AI player
        let currentPlayer = PLAYER_X;
        let boardState = Array(9).fill(null);
        let gameActive = true;

        const winningCombinations = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        // --- Firebase Setup (Placeholder) ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "YOUR_API_KEY", authDomain: "YOUR_AUTH_DOMAIN", projectId: "YOUR_PROJECT_ID" };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'tic-tac-toe-ai-default';
        // console.log("Firebase App ID:", appId);
        // console.log("Firebase Config:", firebaseConfig);
        // --- End Firebase Setup ---

        function createBoard() {
            boardElement.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', handleCellClick);
                boardElement.appendChild(cell);
            }
        }

        function handleCellClick(event) {
            if (!gameActive || currentPlayer === PLAYER_O) return; // فقط بازیکن انسانی کلیک می‌کند و اگر بازی فعال باشد

            const clickedCell = event.target;
            const cellIndex = parseInt(clickedCell.dataset.index);

            if (boardState[cellIndex] !== null) return; // خانه قبلا پر شده است

            makeMove(cellIndex, PLAYER_X);

            if (checkWin(PLAYER_X)) {
                endGame(`شما (X) برنده شدید!`);
                return;
            }
            if (isBoardFull()) {
                endGame('بازی مساوی شد!');
                return;
            }

            // نوبت هوش مصنوعی
            currentPlayer = PLAYER_O;
            statusElement.textContent = 'هوش مصنوعی (O) در حال فکر کردن...';
            // تاخیر کوچک برای حرکت هوش مصنوعی
            setTimeout(() => {
                if (gameActive) { // بررسی مجدد فعال بودن بازی قبل از حرکت AI
                    aiMove();
                }
            }, 700 + Math.random() * 500); // تاخیر تصادفی کوچک
        }

        function makeMove(index, player) {
            boardState[index] = player;
            const cellElement = boardElement.children[index];
            cellElement.textContent = player;
            cellElement.classList.add(player.toLowerCase());
            cellElement.classList.add('occupied'); // برای جلوگیری از هاور
        }

        function aiMove() {
            if (!gameActive) return;

            let move = findBestMove();
            if (move === -1) { 
                move = boardState.findIndex(cell => cell === null);
            }

            if (move !== -1) { 
                 makeMove(move, PLAYER_O);

                if (checkWin(PLAYER_O)) {
                    endGame(`هوش مصنوعی (O) برنده شد!`);
                    return;
                }
                if (isBoardFull()) {
                    endGame('بازی مساوی شد!');
                    return;
                }
            }

            currentPlayer = PLAYER_X;
            statusElement.textContent = 'نوبت شما (X)';
        }

        function findBestMove() {
            // 1. بررسی حرکت برنده برای هوش مصنوعی (O)
            for (let i = 0; i < 9; i++) {
                if (boardState[i] === null) {
                    boardState[i] = PLAYER_O; 
                    if (checkWin(PLAYER_O)) {
                        boardState[i] = null; 
                        return i;
                    }
                    boardState[i] = null; 
                }
            }

            // 2. بررسی حرکت برنده برای بازیکن (X) و مسدود کردن آن
            for (let i = 0; i < 9; i++) {
                if (boardState[i] === null) {
                    boardState[i] = PLAYER_X; 
                    if (checkWin(PLAYER_X)) {
                        boardState[i] = null; 
                        return i; 
                    }
                    boardState[i] = null; 
                }
            }

            // 3. گرفتن مرکز اگر خالی است
            if (boardState[4] === null) return 4;

            // 4. گرفتن یک گوشه خالی به صورت تصادفی
            const corners = [0, 2, 6, 8].filter(index => boardState[index] === null);
            if (corners.length > 0) {
                return corners[Math.floor(Math.random() * corners.length)];
            }

            // 5. گرفتن یک خانه کناری خالی به صورت تصادفی
            const sides = [1, 3, 5, 7].filter(index => boardState[index] === null);
            if (sides.length > 0) {
                return sides[Math.floor(Math.random() * sides.length)];
            }
            
            return -1; 
        }


        function checkWin(player) {
            for (const combination of winningCombinations) {
                const [a, b, c] = combination;
                if (boardState[a] === player && boardState[b] === player && boardState[c] === player) {
                    if (gameActive) { 
                         combination.forEach(index => {
                            if(boardElement.children[index]) { 
                                boardElement.children[index].style.backgroundColor = player === PLAYER_X ? '#fecaca' : '#bfdbfe'; 
                            }
                        });
                    }
                    return true;
                }
            }
            return false;
        }

        function isBoardFull() {
            return boardState.every(cell => cell !== null);
        }

        function endGame(message) {
            gameActive = false;
            statusElement.textContent = message;
            showModal(message);
        }

        function restartGame() {
            currentPlayer = PLAYER_X;
            boardState = Array(9).fill(null);
            gameActive = true;
            statusElement.textContent = 'نوبت شما (X)';
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.textContent = '';
                cell.classList.remove('x', 'o', 'occupied');
                cell.style.backgroundColor = '#ffffff';
            });
            hideModal();
        }

        function showModal(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
            overlay.classList.remove('hidden');
        }

        function hideModal() {
            messageBox.classList.add('hidden');
            overlay.classList.add('hidden');
        }

        // Event Listeners
        restartButton.addEventListener('click', restartGame);
        closeMessageButton.addEventListener('click', () => {
            hideModal();
        });
        overlay.addEventListener('click', hideModal);

        // شروع بازی
        createBoard();
        console.log("بازی دوز با هوش مصنوعی آماده است.");
    </script>
</body>
</html>
